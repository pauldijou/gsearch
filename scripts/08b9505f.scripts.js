function addMessage(a,b){var c="alert";b&&(c+=" alert-"+b),$("#msg").append('<div class="'+c+'"> <button type="button" class="close" data-dismiss="alert">Ã—</button>'+a+"</div>")}function info(a){addMessage(a,"info")}function success(a){addMessage(a,"success")}function warn(a){addMessage(a,"warning")}function error(a){addMessage(a,"error")}function cleanMessages(){$("#msg > div").remove()}function block(){$.blockUI({message:'<h1><img src="images/wait.gif" /> <span class="hidden-phone">Just a moment...</span></h1>'})}function unblock(){$.unblockUI()}function getColorAt(a){return a>=Highcharts.getOptions().colors.length&&(a%=Highcharts.getOptions().colors.length),Highcharts.getOptions().colors[a]}"use strict";var gsearchApp=angular.module("gsearchApp",["ngResource","ui"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/repo/:owner/:name",{templateUrl:"views/repo.html",controller:"RepoCtrl"}).when("/user/:login",{templateUrl:"views/user.html",controller:"UserCtrl"}).otherwise({redirectTo:"/"})}]).config(["$locationProvider",function(a){a.html5Mode(!1).hashPrefix("!")}]);gsearchApp.value("ui.config",{select2:{allowClear:!0},jq:{tooltip:{placement:"right"},popover:{placement:"right",trigger:"hover",html:"true"}}}),$.blockUI.defaults.baseZ=1e4,Date.prototype.toFirstDayWeek=function(){this.setDate(this.getDate()-this.getDay()+(this.getDay()==0?-6:1))},Highcharts.getOptions().colors=$.map(Highcharts.getOptions().colors,function(a){return{radialGradient:{cx:.5,cy:.3,r:.7},stops:[[0,a],[1,Highcharts.Color(a).brighten(-0.3).get("rgb")]]}}),"use strict",gsearchApp.controller("MainCtrl",["$scope",function(a){}]),"use strict",gsearchApp.controller("RepoCtrl",["$scope","$routeParams","$filter","repo",function(a,b,c,d){a.owner=b.owner,a.name=b.name,a.committers=[],a.timeline=[],a.repo=d.get({owner:a.owner,name:a.name}),a.commits=d.commits({owner:a.owner,name:a.name},function(){_.each(a.commits,function(b){if(b.author){var c=_.where(a.committers,{login:b.author.login}),d;c.length==0?(d=b.author,d.numberOfCommits=0,a.committers.push(d)):d=c.pop(),d.numberOfCommits++}}),a.committers=_.sortBy(a.committers,function(a){return 1/a.numberOfCommits}),a.updateCommitsPieChart(),a.updateCommitsColumnChart(),a.updateCommitsAreaStackChart(),a.fillTimeline()}),a.fillTimeline=function(){var b=[];_.each(a.commits,function(a){var d=a.commit,e=new Date(d.author.date),f={};f.date=c("date")(e,"yyyy-MM-dd hh:mm:ss");var g=c("date")(e,"yyyy-MM"),h=c("date")(e,"MMM yyyy");e.toFirstDayWeek();var i=c("date")(e,"yyyy-MM-dd"),j=c("date")(e,"EEE dd/MM")+" - ";e.setDate(e.getDate()+6),j+=c("date")(e,"EEE dd/MM");var k=_.where(b,{key:g});k.length==0?(k={key:g,title:h,weeks:[]},b.push(k)):k=k.pop();var l=_.where(k.weeks,{key:i});l.length==0?(l={key:i,title:j,events:[]},k.weeks.push(l)):l=l.pop(),f.sha=a.sha,f.authorName=d.author.name,f.authorEmail=d.author.email,f.url=d.url.replace("https://api.github.com/repos","https://github.com").replace("/git/commits/","/commit/").replace("/commits/","/commit/"),f.message=d.message,l.events.push(f)}),_.each(b,function(a){a.totalCommits=0,_.each(a.weeks,function(b){b.events=_.sortBy(b.events,"date"),b.events.reverse(),b.totalCommits=b.events.length,a.totalCommits+=b.events.length}),a.weeks=_.sortBy(a.weeks,"key"),a.weeks.reverse()}),b=_.sortBy(b,"key"),b.reverse(),a.timeline=b},a.updateCommitsPieChart=function(){var b=[];_.each(a.committers,function(a){b.push([a.login,a.numberOfCommits])});var c=new Highcharts.Chart({chart:{renderTo:"commitsPieChart",plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},title:{text:"Commits repartition"},tooltip:{pointFormat:"{series.name}: <b>{point.percentage}% ({point.y})</b>",percentageDecimals:2},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,color:"#000000",connectorColor:"#000000",formatter:function(){return"<b>"+this.point.name+"</b>: "+Highcharts.numberFormat(this.percentage,2)+"% ("+this.point.y+")"}}}},series:[{type:"pie",name:"Commits",data:b}]})},a.updateCommitsColumnChart=function(){var b=[],c=[];_.each(a.committers,function(a,d){b.push(a.login),c.push(a.numberOfCommits)});var d=new Highcharts.Chart({chart:{renderTo:"commitsColumnChart",type:"column",margin:[50,50,100,80]},title:{text:"Number of commits"},xAxis:{categories:b,labels:{rotation:-45,align:"right",style:{fontSize:"13px",fontFamily:"Verdana, sans-serif"}}},yAxis:{min:0,title:{text:"Commits"}},plotOptions:{column:{colorByPoint:!0}},legend:{enabled:!1},tooltip:{formatter:function(){return"<b>"+this.x+"</b><br/>"+"Commits: "+this.y}},series:[{name:"Commits",data:c,dataLabels:{enabled:!0,formatter:function(){return this.y},style:{fontSize:"13px",fontFamily:"Verdana, sans-serif"}}}]})},a.updateCommitsAreaStackChart=function(){var b=_.groupBy(a.commits,function(a){var b=new Date(Date.parse(a.commit.author.date));return b.toFirstDayWeek(),Highcharts.dateFormat("%d/%m/%Y",b.getTime())}),c=[],d=[];_.each(a.committers,function(a){d.push({name:a.login,data:[0]})});var e=0;_.each(b,function(a,b){c.push(b),_.each(a,function(a){if(a.author){var b=_.where(d,{name:a.author.login}).pop();b.data[e]?b.data[e]++:e==0?b.data[e]=1:b.data[e]=1+b.data[e-1]}}),_.each(d,function(a){e>0&&!a.data[e]&&(a.data[e]=a.data[e-1])}),e++});var f=new Highcharts.Chart({chart:{renderTo:"commitsAreaStackChart",type:"area"},title:{text:"Stacked commits per week and per author"},xAxis:{categories:c,tickmarkPlacement:"on",title:{enabled:!1},labels:{rotation:-45,align:"right",style:{fontSize:"13px",fontFamily:"Verdana, sans-serif"}}},yAxis:{title:{text:"Commits"},labels:{formatter:function(){return this.value}}},tooltip:{formatter:function(){return""+this.x+", "+this.series.name+": "+this.y+" commits"}},plotOptions:{area:{stacking:"normal",lineColor:"#666666",lineWidth:1,marker:{lineWidth:1,lineColor:"#666666"}}},series:d})}}]),"use strict",gsearchApp.controller("AppCtrl",["$scope","$location","searchRepos","searchUsers",function(a,b,c,d){a.search="",a.isUserSearch=!1,a.result=[],a.doSearch=function(){a.result=[]},a.doSearch=function(){block();if(a.search.indexOf("@")==0)var e=d.query({keyword:a.search},function(){cleanMessages(),a.result=e.users,a.isUserSearch=!0,b.path("/"),e.users.length==0&&error("No respository found."),unblock()},function(){cleanMessages(),a.result=[],b.path("/"),error("No respository found."),unblock()});else var f=c.query({keyword:a.search},function(){cleanMessages(),a.result=f.repositories,a.isUserSearch=!1,b.path("/"),f.repositories.length==0&&error("No respository found."),unblock()},function(){cleanMessages(),a.result=[],b.path("/"),error("No respository found."),unblock()})},a.cleanResult=function(){a.result=[],b.path("/")},a.hasResult=function(){return a.result.length>0},a.plural=function(a,b){return b=b||"s",a>1?b:""},a.getRepoFullName=function(a,b){return a+"/"+b},a.showRepo=function(a){b.path("repo/"+a)},a.showUser=function(a){b.path("user/"+a)},a.getFavoriteRepos=function(){return angular.fromJson(localStorage.getItem("favoriteRepos"))||new Array},a.getFavoriteUsers=function(){return angular.fromJson(localStorage.getItem("favoriteUsers"))||new Array},a.setFavoriteRepos=function(a){localStorage.setItem("favoriteRepos",angular.toJson(a))},a.setFavoriteUsers=function(a){localStorage.setItem("favoriteUsers",angular.toJson(a))},a.clearFavoriteRepos=function(){localStorage.removeItem("favoriteRepos")},a.clearFavoriteUsers=function(){localStorage.removeItem("favoriteUsers")},a.hasFavoriteRepos=function(){return a.getFavoriteRepos().length>0},a.hasFavoriteUsers=function(){return a.getFavoriteUsers().length>0},a.isFavoriteRepo=function(b){return _.indexOf(a.getFavoriteRepos(),b)>-1},a.isFavoriteUser=function(b){return _.indexOf(a.getFavoriteUsers(),b)>-1},a.toggleFavoriteRepo=function(b,c){a.isFavoriteRepo(b)?a.removeFavoriteRepo(b,c):a.addFavoriteRepo(b,c)},a.toggleFavoriteUser=function(b,c){a.isFavoriteUser(b)?a.removeFavoriteUser(b,c):a.addFavoriteUser(b,c)},a.addFavoriteRepo=function(b,c){c.stopPropagation();var d=a.getFavoriteRepos();d.push(b),a.setFavoriteRepos(d)},a.addFavoriteUser=function(b,c){c.stopPropagation();var d=a.getFavoriteUsers();d.push(b),a.setFavoriteUsers(d)},a.removeFavoriteRepo=function(b,c){c.stopPropagation(),a.setFavoriteRepos(_.without(a.getFavoriteRepos(),b))},a.removeFavoriteUser=function(b,c){c.stopPropagation(),a.setFavoriteUsers(_.without(a.getFavoriteUsers(),b))}}]),"use strict",gsearchApp.factory("repo",["$resource",function(a){return a("https://api.github.com/repos/:owner/:name/:param1",{},{commits:{method:"GET",params:{param1:"commits",per_page:100},isArray:!0}})}]),"use strict",gsearchApp.factory("searchRepos",["$resource",function(a){return a("https://api.github.com/legacy/repos/search/:keyword",{},{query:{method:"GET",isArray:!1}})}]),"use strict",gsearchApp.factory("searchUsers",["$resource",function(a){return a("https://api.github.com/legacy/user/search/:keyword",{},{query:{method:"GET",isArray:!1}})}]),"use strict",gsearchApp.controller("UserCtrl",["$scope","$routeParams","user",function(a,b,c){a.login=b.login,a.isUser=!0,a.user=c.get({login:a.login},function(){a.user.type.toLowerCase()==="organisation"&&(a.isUser=!1)}),a.repos=c.repos({login:a.login})}]),"use strict",gsearchApp.directive("tabs",function(){return{restrict:"E",transclude:!0,replace:!0,scope:{},controller:["$scope","$element",function(a,b){a.tabs=[],a.select=function(b){angular.forEach(a.tabs,function(a){a.selected=!1}),b.selected=!0,b.onSelected&&b.onSelected()},this.add=function(b){a.tabs.length==0&&a.select(b),a.tabs.push(b)}}],template:'<div class="tabbable"><ul class="nav nav-tabs"><li data-ng-repeat="tab in tabs" data-ng-class="{active:tab.selected}"><a href="" data-ng-click="select(tab)">{{tab.title}}</a></li></ul><div class="tab-content" data-ng-transclude=""></div></div>'}}),"use strict",gsearchApp.directive("tab",function(){return{require:"^tabs",restrict:"E",transclude:!0,replace:!0,scope:{title:"@",onSelected:"&"},link:function(a,b,c,d){d.add(a)},template:'<div class="tab-pane" data-ng-class="{active: selected}" data-ng-transclude=""></div>'}}),"use strict",gsearchApp.directive("buttonFav",function(){return{restrict:"E",transclude:!1,replace:!0,scope:{isFavorite:"=",onClick:"&",label:"=",tooltip:"=",size:"@"},template:'<button type="button" class="btn" data-ng-class="{\'btn-primary\': isFavorite, \'btn-small\': size == \'small\', \'btn-large\': size == \'large\'}" data-ng-click="onClick({$event: $event})" data-original-title="{{tooltip}}" data-ui-jq="tooltip"><i class="icon-star" data-ng-class="{\'icon-white\': isFavorite}"></i> {{label}}</button>'}}),"use strict",gsearchApp.directive("booleanIcon",function(){return{restrict:"E",transclude:!1,replace:!0,scope:{value:"="},template:"<i data-ng-class=\"{'icon-ok': value, 'icon-remove': !value}\"></i>"}}),"use strict",gsearchApp.factory("user",["$resource",function(a){return a("https://api.github.com/users/:login/:param1",{},{repos:{method:"GET",params:{param1:"repos"},isArray:!0}})}]);